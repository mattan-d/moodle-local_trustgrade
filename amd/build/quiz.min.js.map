{"version":3,"file":"quiz.min.js","sources":["../src/quiz.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n\ndefine([\"jquery\", \"core/ajax\", \"core/notification\", \"core/str\"], ($, Ajax, Notification, Str) => {\n  var Quiz = {\n    session: null,\n    questions: [],\n    settings: {},\n    cmid: 0,\n    submissionid: 0,\n    currentQuestion: 0,\n    answers: {},\n    timer: null,\n    timeRemaining: 0,\n    attemptStarted: false,\n    attemptCompleted: false,\n    windowBlurCount: 0,\n    maxWindowBlurs: 3,\n    autoSaveInterval: null,\n\n    init: function (session) {\n      if (!session || !session.questions || session.questions.length === 0) {\n        return\n      }\n\n      this.session = session\n      this.questions = session.questions\n      this.settings = session.settings\n      this.cmid = session.cmid\n      this.submissionid = session.submissionid\n      this.currentQuestion = session.current_question\n      this.answers = session.answers\n      this.attemptStarted = session.attempt_started\n      this.attemptCompleted = session.attempt_completed\n      this.windowBlurCount = session.window_blur_count\n      this.timeRemaining = session.time_remaining\n\n      if (this.attemptCompleted) {\n        this.showResults()\n        return\n      }\n\n      if (!this.attemptStarted) {\n        this.showIntegrityWarning()\n      } else {\n        this.resumeQuiz()\n      }\n    },\n\n    resumeQuiz: function () {\n      this.bindEvents()\n      this.bindIntegrityEvents()\n      this.startAutoSave()\n      this.showQuestion(this.currentQuestion)\n      this.updateCounter()\n    },\n\n    showIntegrityWarning: function () {\n      Promise.all([\n        Str.get_string(\"important_formal_assessment\", \"local_trustgrade\"),\n        Str.get_string(\"read_carefully\", \"local_trustgrade\"),\n        Str.get_string(\"one_attempt_only\", \"local_trustgrade\"),\n        Str.get_string(\"no_going_back\", \"local_trustgrade\"),\n        Str.get_string(\"no_restarts\", \"local_trustgrade\"),\n        Str.get_string(\"time_limits\", \"local_trustgrade\"),\n        Str.get_string(\"no_cheating\", \"local_trustgrade\"),\n        Str.get_string(\"final_grade\", \"local_trustgrade\"),\n        Str.get_string(\"stay_focused\", \"local_trustgrade\"),\n        Str.get_string(\"cannot_restart_notice\", \"local_trustgrade\"),\n        Str.get_string(\"understand_start_quiz\", \"local_trustgrade\"),\n      ]).then((strings) => {\n        var warningHtml = `\n          <div class=\"quiz-integrity-warning alert alert-warning\">\n            <h4><i class=\"fa fa-exclamation-triangle\"></i> ${strings[0]}</h4>\n            <p><strong>${strings[1]}</strong></p>\n            <ul>\n              <li><strong>${strings[2]}</strong></li>\n              <li><strong>${strings[3]}</strong></li>\n              <li><strong>${strings[4]}</strong></li>\n              <li><strong>${strings[5]}</strong></li>\n              <li><strong>${strings[6]}</strong></li>\n              <li><strong>${strings[7]}</strong></li>\n              <li><strong>${strings[8]}</strong></li>\n            </ul>\n            <p class=\"text-danger\"><strong>${strings[9]}</strong></p>\n            <div class=\"text-center mt-3\">\n              <button id=\"start-quiz-btn\" class=\"btn btn-danger btn-lg\">\n                <i class=\"fa fa-play\"></i> ${strings[10]}\n              </button>\n            </div>\n          </div>\n        `\n        $(\".quiz-content\").html(warningHtml)\n        $(\".question-counter\").hide()\n        $(\".quiz-navigation\").hide()\n        this.bindStartEvent()\n      })\n    },\n\n    bindStartEvent: function () {\n      $(document)\n        .off(\"click.quizstart\")\n        .on(\"click.quizstart\", \"#start-quiz-btn\", () => {\n          this.startQuizAttempt()\n        })\n    },\n\n    startQuizAttempt: function () {\n      var promise = Ajax.call([\n        {\n          methodname: \"local_trustgrade_start_quiz_attempt\",\n          args: {\n            cmid: this.cmid,\n            submissionid: this.submissionid,\n          },\n        },\n      ])[0]\n\n      promise\n        .done((response) => {\n          if (response.success) {\n            this.attemptStarted = true\n            Str.get_string(\"quiz_started_notice\", \"local_trustgrade\").then((message) => {\n              Notification.addNotification({ message: message, type: \"info\" })\n            })\n            this.resumeQuiz()\n          } else {\n            Str.get_string(\"failed_start_session\", \"local_trustgrade\").then((message) => {\n              Notification.addNotification({ message: response.error || message, type: \"error\" })\n            })\n          }\n        })\n        .fail(Notification.exception)\n    },\n\n    startAutoSave: function () {\n      this.autoSaveInterval = setInterval(() => {\n        this.saveSessionState()\n      }, 10000)\n    },\n\n    saveSessionState: function () {\n      if (!this.attemptStarted || this.attemptCompleted) {\n        return\n      }\n\n      var updates = {\n        current_question: this.currentQuestion,\n        answers: this.answers,\n        time_remaining: this.timeRemaining,\n        window_blur_count: this.windowBlurCount,\n      }\n\n      Ajax.call([\n        {\n          methodname: \"local_trustgrade_update_quiz_session\",\n          args: {\n            cmid: this.cmid,\n            submissionid: this.submissionid,\n            updates: JSON.stringify(updates),\n          },\n        },\n      ])\n    },\n\n    bindEvents: function () {\n      $(document).off(\"click.quiz\")\n      $(document).on(\"click.quiz\", \"#next-btn\", () => {\n        if (this.validateCurrentAnswer()) {\n          this.saveCurrentAnswer()\n          this.advanceToNextQuestion()\n        }\n      })\n      $(document).on(\"click.quiz\", \"#finish-btn\", () => {\n        if (this.validateCurrentAnswer()) {\n          this.saveCurrentAnswer()\n          this.finishQuiz()\n        }\n      })\n      $(document).on(\"change.quiz\", 'input[name=\"answer\"]', () => {\n        this.updateNavigationButtons()\n        this.saveSessionState()\n      })\n      $(document).on(\"input.quiz\", 'textarea[name=\"answer\"]', () => {\n        this.updateNavigationButtons()\n        this.saveSessionState()\n      })\n    },\n\n    bindIntegrityEvents: function () {\n      $(window).on(\"blur.quiz\", () => {\n        if (this.attemptStarted && !this.attemptCompleted) {\n          this.windowBlurCount++\n          this.logIntegrityViolation(\"window_blur\", { count: this.windowBlurCount })\n          if (this.windowBlurCount >= this.maxWindowBlurs) {\n            this.showIntegrityViolation()\n          } else {\n            Str.get_string(\"window_switching_warning\", \"local_trustgrade\", {\n              count: this.windowBlurCount,\n              max: this.maxWindowBlurs,\n            }).then((message) => {\n              Notification.addNotification({ message: message, type: \"warning\" })\n            })\n          }\n        }\n      })\n      $(document).on(\"contextmenu.quiz\", () => {\n        if (this.attemptStarted && !this.attemptCompleted) {\n          this.logIntegrityViolation(\"right_click_attempt\")\n          return false\n        }\n      })\n      $(document).on(\"keydown.quiz\", (e) => {\n        if (this.attemptStarted && !this.attemptCompleted) {\n          if (\n            e.keyCode === 123 ||\n            (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) ||\n            (e.ctrlKey && e.keyCode === 85)\n          ) {\n            e.preventDefault()\n            this.logIntegrityViolation(\"dev_tools_attempt\")\n            Str.get_string(\"dev_tools_blocked\", \"local_trustgrade\").then((message) => {\n              Notification.addNotification({ message: message, type: \"error\" })\n            })\n            return false\n          }\n        }\n      })\n      $(window).on(\"beforeunload.quiz\", () => {\n        if (this.attemptStarted && !this.attemptCompleted) {\n          return Str.get_string(\"quiz_progress_saved\", \"local_trustgrade\").then((message) => message)\n        }\n      })\n    },\n\n    logIntegrityViolation: function (violationType, violationData = {}) {\n      Ajax.call([\n        {\n          methodname: \"local_trustgrade_log_integrity_violation\",\n          args: {\n            cmid: this.cmid,\n            submissionid: this.submissionid,\n            violation_type: violationType,\n            violation_data: JSON.stringify(violationData),\n          },\n        },\n      ])\n    },\n\n    getQuestionText: (q) => {\n      if (!q) return \"\"\n      return q.text || q.question || \"\"\n    },\n\n    getOptionText: (option) => {\n      if (option == null) return \"\"\n      if (typeof option === \"string\") return option\n      if (typeof option === \"object\") {\n        return option.text ?? option.label ?? String(option)\n      }\n      return String(option)\n    },\n\n    getOptionExplanation: (question, index) => {\n      if (!question) return \"\"\n      const options = question.options || []\n      const i = typeof index === \"number\" ? index : Number.parseInt(index, 10)\n      if (Number.isNaN(i) || i == null) return \"\"\n\n      // New pattern: explanation on the option object\n      if (Array.isArray(options) && options[i] && typeof options[i] === \"object\" && \"explanation\" in options[i]) {\n        return options[i].explanation || \"\"\n      }\n\n      // Alternate pattern: explanations array aligning to options index\n      if (Array.isArray(question.explanations)) {\n        return question.explanations[i] || \"\"\n      }\n\n      // Alternate pattern: map object, e.g., { \"true\": \"...\", \"false\": \"...\" }\n      if (question.explanations && typeof question.explanations === \"object\") {\n        // Try boolean-like keys, then index keys\n        const key = i === 1 ? \"true\" : i === 0 ? \"false\" : String(i)\n        return question.explanations[key] || question.explanations[String(i)] || \"\"\n      }\n\n      // Fallback\n      if (question.option_explanations && Array.isArray(question.option_explanations)) {\n        return question.option_explanations[i] || \"\"\n      }\n\n      return \"\"\n    },\n\n    getCorrectAnswerIndex: (question) => {\n      if (!question) return null\n\n      // Backward-compatible: numeric index\n      if (Number.isInteger(question.correct_answer)) {\n        return question.correct_answer\n      }\n\n      // New pattern: detect correct option by flag\n      const options = question.options || []\n      for (let i = 0; i < options.length; i++) {\n        const opt = options[i]\n        if (\n          opt &&\n          typeof opt === \"object\" &&\n          (opt.correct === true || opt.is_correct === true || opt.isCorrect === true)\n        ) {\n          return i\n        }\n      }\n      return null\n    },\n\n    isAnswerCorrect: function (question, userAnswer) {\n      if (!question) return false\n\n      if (question.type === \"true_false\") {\n        // Backward-compat: boolean compare\n        if (typeof question.correct_answer !== \"boolean\") return false\n        let userBool = null\n        if (userAnswer === true || userAnswer === \"true\" || userAnswer === 1 || userAnswer === \"1\") userBool = true\n        else if (userAnswer === false || userAnswer === \"false\" || userAnswer === 0 || userAnswer === \"0\")\n          userBool = false\n        return userBool !== null && userBool === question.correct_answer\n      }\n\n      const correctIndex = this.getCorrectAnswerIndex(question)\n      if (correctIndex == null) return false\n      const userIndex = typeof userAnswer === \"number\" ? userAnswer : Number.parseInt(userAnswer, 10)\n      return userIndex === correctIndex\n    },\n\n    advanceToNextQuestion: function () {\n      if (this.currentQuestion < this.questions.length - 1) {\n        this.currentQuestion++\n        this.showQuestion(this.currentQuestion)\n        this.updateCounter()\n        this.saveSessionState()\n      }\n    },\n\n    showQuestion: function (index) {\n      var question = this.questions[index]\n      Promise.all([\n        Str.get_string(\n          \"quiz_progress_complete\",\n          \"local_trustgrade\",\n          Math.round(((index + 1) / this.questions.length) * 100),\n        ),\n        Str.get_string(\"question_x_of_y\", \"local_trustgrade\", { current: index + 1, total: this.questions.length }),\n        Str.get_string(\"instructor_question\", \"local_trustgrade\"),\n        Str.get_string(\"based_on_submission\", \"local_trustgrade\"),\n        Str.get_string(\"progress_auto_saved\", \"local_trustgrade\"),\n        Str.get_string(\"true\", \"local_trustgrade\"),\n        Str.get_string(\"false\", \"local_trustgrade\"),\n        Str.get_string(\"enter_answer_placeholder\", \"local_trustgrade\"),\n      ]).then((strings) => {\n        var progress = Math.round(((index + 1) / this.questions.length) * 100)\n        var bloomsLevel =\n          (question &&\n            question.metadata &&\n            (question.metadata.blooms_level || question.metadata.blooms || question.metadata.bloomsLevel)) ||\n          question.difficulty ||\n          \"medium\"\n        var html = `<div class=\"quiz-progress mb-3\">\n          <div class=\"progress\">\n            <div class=\"progress-bar bg-primary\" style=\"width: ${progress}%\"></div>\n          </div>\n          <small class=\"text-muted\">${strings[1]} (${strings[0]})</small>\n        </div>\n        <div class=\"question-container\">\n          <div class=\"question-header\">\n            <span class=\"question-source badge ${question.source === \"instructor\" ? \"badge-primary\" : \"badge-success\"}\">\n              ${question.source === \"instructor\" ? strings[2] : strings[3]}\n            </span>\n            <span class=\"question-difficulty badge badge-secondary\">${bloomsLevel}</span>\n            <span class=\"question-points\">${question.points || 10} points</span>\n          </div>\n          <div class=\"alert alert-info\">\n            <i class=\"fa fa-info-circle\"></i> \n            <small>${strings[4]}</small>\n          </div>\n          <h3 class=\"question-text\">${this.getQuestionText(question)}</h3>`\n\n        if (question.type === \"multiple_choice\" && question.options) {\n          html += `<div class=\"question-options\">`\n          question.options.forEach((option, optIndex) => {\n            var checked = this.answers[index] === optIndex ? \"checked\" : \"\"\n            var label = this.getOptionText(option)\n            html += `<div class=\"form-check\">\n              <input class=\"form-check-input\" type=\"radio\" name=\"answer\" value=\"${optIndex}\" id=\"option_${optIndex}\" ${checked}>\n              <label class=\"form-check-label\" for=\"option_${optIndex}\">${label}</label>\n            </div>`\n          })\n          html += `</div>`\n        } else if (question.type === \"true_false\") {\n          var trueChecked = this.answers[index] === true ? \"checked\" : \"\"\n          var falseChecked = this.answers[index] === false ? \"checked\" : \"\"\n          html += `<div class=\"question-options\">\n            <div class=\"form-check\">\n              <input class=\"form-check-input\" type=\"radio\" name=\"answer\" value=\"true\" id=\"true_option\" ${trueChecked}>\n              <label class=\"form-check-label\" for=\"true_option\">${strings[5]}</label>\n            </div>\n            <div class=\"form-check\">\n              <input class=\"form-check-input\" type=\"radio\" name=\"answer\" value=\"false\" id=\"false_option\" ${falseChecked}>\n              <label class=\"form-check-label\" for=\"false_option\">${strings[6]}</label>\n            </div>\n          </div>`\n        } else if (question.type === \"short_answer\") {\n          var savedAnswer = this.answers[index] || \"\"\n          html += `<div class=\"question-options\">\n            <textarea class=\"form-control\" name=\"answer\" rows=\"4\" placeholder=\"${strings[7]}\">${savedAnswer}</textarea>\n          </div>`\n        }\n        html += `</div>`\n        $(\".quiz-content\").html(html)\n        $(\".question-counter\").show()\n        $(\".quiz-navigation\").show()\n        this.updateNavigationButtons()\n        if (this.settings.show_countdown) {\n          this.startTimer()\n        }\n      })\n    },\n\n    startTimer: function () {\n      if (!this.settings.show_countdown) return\n      if (this.timer) clearInterval(this.timer)\n      if (this.timeRemaining <= 0 || this.timeRemaining > this.settings.time_per_question) {\n        this.timeRemaining = this.settings.time_per_question\n      }\n      this.updateTimerDisplay()\n      $(\".question-timer\").show()\n      this.timer = setInterval(() => {\n        this.timeRemaining--\n        this.updateTimerDisplay()\n        if (this.timeRemaining <= 0) {\n          this.stopTimer()\n          this.autoAdvance()\n        }\n      }, 1000)\n    },\n\n    stopTimer: function () {\n      if (this.timer) {\n        clearInterval(this.timer)\n        this.timer = null\n      }\n      $(\".question-timer\").hide()\n    },\n\n    updateTimerDisplay: function () {\n      var minutes = Math.floor(this.timeRemaining / 60)\n      var seconds = this.timeRemaining % 60\n      var timeString = minutes + \":\" + (seconds < 10 ? \"0\" : \"\") + seconds\n      Str.get_string(\"time_remaining\", \"local_trustgrade\", timeString).then((message) => {\n        var timerClass = this.timeRemaining <= 5 ? \"timer-warning\" : \"\"\n        var timerHtml = `<div class=\"timer-display ${timerClass}\">\n                          <i class=\"fa fa-clock-o\"></i> ${message}\n                        </div>`\n        $(\".question-timer\").html(timerHtml)\n      })\n    },\n\n    autoAdvance: function () {\n      this.saveCurrentAnswer()\n      if (this.currentQuestion < this.questions.length - 1) {\n        this.advanceToNextQuestion()\n      } else {\n        this.finishQuiz()\n      }\n    },\n\n    updateCounter: function () {\n      var total = this.questions.length\n      var current = this.currentQuestion + 1\n      Str.get_string(\"question_x_of_y\", \"local_trustgrade\", { current: current, total: total }).then((message) => {\n        $(\".question-counter\").html(message)\n      })\n    },\n\n    updateNavigationButtons: function () {\n      $(\"#prev-btn\").hide()\n      Promise.all([\n        Str.get_string(\"next_question\", \"local_trustgrade\"),\n        Str.get_string(\"submit_final_answers\", \"local_trustgrade\"),\n      ]).then((strings) => {\n        if (this.currentQuestion < this.questions.length - 1) {\n          $(\"#next-btn\").show().text(strings[0])\n          $(\"#finish-btn\").hide()\n        } else {\n          $(\"#next-btn\").hide()\n          $(\"#finish-btn\").show().text(strings[1])\n        }\n      })\n    },\n\n    validateCurrentAnswer: function () {\n      var question = this.questions[this.currentQuestion]\n      var hasAnswer = false\n      if (question.type === \"multiple_choice\" || question.type === \"true_false\") {\n        hasAnswer = $('input[name=\"answer\"]:checked').length > 0\n      } else if (question.type === \"short_answer\") {\n        hasAnswer = $('textarea[name=\"answer\"]').val().trim().length > 0\n      }\n      if (!hasAnswer) {\n        Str.get_string(\"provide_answer_warning\", \"local_trustgrade\").then((message) => {\n          Notification.addNotification({ message: message, type: \"warning\" })\n        })\n        return false\n      }\n      return true\n    },\n\n    saveCurrentAnswer: function () {\n      var question = this.questions[this.currentQuestion]\n      var answer = null\n      if (question.type === \"multiple_choice\") {\n        answer = $('input[name=\"answer\"]:checked').val()\n        if (answer !== undefined) this.answers[this.currentQuestion] = Number.parseInt(answer)\n      } else if (question.type === \"true_false\") {\n        answer = $('input[name=\"answer\"]:checked').val()\n        if (answer !== undefined) this.answers[this.currentQuestion] = answer === \"true\"\n      } else if (question.type === \"short_answer\") {\n        answer = $('textarea[name=\"answer\"]').val().trim()\n        this.answers[this.currentQuestion] = answer\n      }\n      this.timeRemaining = this.settings.time_per_question\n    },\n\n    finishQuiz: function () {\n      if (this.attemptCompleted) return\n      this.attemptCompleted = true\n      this.stopTimer()\n      if (this.autoSaveInterval) clearInterval(this.autoSaveInterval)\n      $(window).off(\".quiz\")\n      $(document).off(\".quiz\")\n      var score = this.calculateScore()\n      var promise = Ajax.call([\n        {\n          methodname: \"local_trustgrade_complete_quiz_session\",\n          args: {\n            cmid: this.cmid,\n            submissionid: this.submissionid,\n            final_answers: JSON.stringify(this.answers),\n            final_score: score,\n          },\n        },\n      ])[0]\n\n      promise\n        .done((response) => {\n          if (!response.success) {\n            Str.get_string(\"failed_save_results\", \"local_trustgrade\", response.error || \"Unknown error\").then(\n              (message) => {\n                Notification.addNotification({ message: message, type: \"error\" })\n              },\n            )\n          }\n          this.showResults()\n        })\n        .fail(() => {\n          Str.get_string(\"failed_save_contact_instructor\", \"local_trustgrade\").then((message) => {\n            Notification.addNotification({ message: message, type: \"error\" })\n          })\n          this.showResults()\n        })\n    },\n\n    calculateScore: function () {\n      var score = 0\n      this.questions.forEach((question, index) => {\n        var userAnswer = this.answers[index]\n        var isCorrect = this.isAnswerCorrect(question, userAnswer)\n        var points = question.points || 10\n        if (isCorrect) score += points\n      })\n      return score\n    },\n\n    showResults: function () {\n      var score = 0\n      var totalPoints = 0\n      Promise.all([\n        Str.get_string(\"quiz_completed_header\", \"local_trustgrade\"),\n        Str.get_string(\"quiz_completed_message\", \"local_trustgrade\"),\n        Str.get_string(\"correct\", \"local_trustgrade\"),\n        Str.get_string(\"incorrect\", \"local_trustgrade\"),\n        Str.get_string(\"your_answer\", \"local_trustgrade\"),\n        Str.get_string(\"correct_answer_was\", \"local_trustgrade\"),\n        Str.get_string(\"no_answer\", \"local_trustgrade\"),\n        Str.get_string(\"explanation\", \"local_trustgrade\"),\n        Str.get_string(\"final_grade_notice\", \"local_trustgrade\"),\n        Str.get_string(\"true\", \"local_trustgrade\"),\n        Str.get_string(\"false\", \"local_trustgrade\"),\n      ]).then((strings) => {\n        var resultsHtml = `<div class=\"quiz-completion-header alert alert-success\">\n          <h2><i class=\"fa fa-check-circle\"></i> ${strings[0]}</h2>\n          <p>${strings[1]}</p>\n        </div>\n        <div class=\"results-summary\">`\n\n        this.questions.forEach((question, index) => {\n          var userAnswer = this.answers[index]\n          var isCorrect = this.isAnswerCorrect(question, userAnswer)\n          var points = question.points || 10\n          totalPoints += points\n          if (isCorrect) score += points\n\n          resultsHtml += `<div class=\"result-item ${isCorrect ? \"correct\" : \"incorrect\"}\">\n            <div class=\"result-header\">\n              <span class=\"question-number\">Question ${index + 1}</span>\n              <span class=\"result-status ${isCorrect ? \"text-success\" : \"text-danger\"}\">\n                ${isCorrect ? `✓ ${strings[2]}` : `✗ ${strings[3]}`}\n              </span>\n              <span class=\"result-points\">${isCorrect ? points : 0}/${points} points</span>\n            </div>\n            <p class=\"question-text\">${this.getQuestionText(question)}</p>`\n\n          // Show the user's answer text\n          if (question.type === \"multiple_choice\") {\n            var userAnswerText = strings[6]\n            if (\n              userAnswer !== undefined &&\n              userAnswer !== null &&\n              question.options &&\n              question.options[Number(userAnswer)] !== undefined\n            ) {\n              userAnswerText = this.getOptionText(question.options[Number(userAnswer)])\n            }\n            resultsHtml += `<p><strong>${strings[4].replace(\"{$a}\", userAnswerText)}</strong></p>`\n\n            // Show the explanation corresponding to the selected answer (per-answer explanation)\n            var explanationText = this.getOptionExplanation(question, Number(userAnswer))\n            if (explanationText) {\n              resultsHtml += `<div class=\"explanation\"><strong>${strings[7]}:</strong> ${explanationText}</div>`\n            }\n          } else if (question.type === \"true_false\") {\n            var userAnswerText = userAnswer !== undefined ? (userAnswer ? strings[9] : strings[10]) : strings[6]\n            resultsHtml += `<p><strong>${strings[4].replace(\"{$a}\", userAnswerText)}</strong></p>`\n\n            // Attempt to show a per-answer explanation if provided in a map or options\n            var tfExplanation = \"\"\n            if (question.explanations && typeof question.explanations === \"object\") {\n              if (userAnswer === true || userAnswer === \"true\" || userAnswer === 1 || userAnswer === \"1\") {\n                tfExplanation =\n                  question.explanations.true || question.explanations[\"1\"] || question.explanations[1] || \"\"\n              } else if (userAnswer === false || userAnswer === \"false\" || userAnswer === 0 || userAnswer === \"0\") {\n                tfExplanation =\n                  question.explanations.false || question.explanations[\"0\"] || question.explanations[0] || \"\"\n              }\n            } else if (Array.isArray(question.options) && question.options.length === 2) {\n              // If options are objects, try to read explanation\n              var idx = userAnswer === true || userAnswer === \"true\" || userAnswer === 1 || userAnswer === \"1\" ? 1 : 0\n              if (\n                question.options[idx] &&\n                typeof question.options[idx] === \"object\" &&\n                \"explanation\" in question.options[idx]\n              ) {\n                tfExplanation = question.options[idx].explanation || \"\"\n              }\n            }\n            if (tfExplanation) {\n              resultsHtml += `<div class=\"explanation\"><strong>${strings[7]}:</strong> ${tfExplanation}</div>`\n            }\n          } else if (question.type === \"short_answer\") {\n            resultsHtml += `<p><strong>${strings[4].replace(\"{$a}\", userAnswer || strings[6])}</strong></p>`\n            // No per-answer explanation for short answer in the new pattern\n          }\n\n          // IMPORTANT CHANGE: Do NOT show the \"Correct answer was\" line.\n\n          resultsHtml += `</div>`\n        })\n\n        var percentage = totalPoints > 0 ? Math.round((score / totalPoints) * 100) : 0\n        Str.get_string(\"final_score\", \"local_trustgrade\", {\n          score: score,\n          total: totalPoints,\n          percentage: percentage,\n        }).then((scoreString) => {\n          resultsHtml =\n            `<div class=\"score-summary alert alert-info\">\n              <h3>${scoreString}</h3>\n              <p><strong>${strings[8]}</strong></p>\n            </div>` + resultsHtml\n          resultsHtml += `</div>`\n          if (this.windowBlurCount > 0) {\n            Promise.all([\n              Str.get_string(\"integrity_report_header\", \"local_trustgrade\"),\n              Str.get_string(\"window_focus_lost\", \"local_trustgrade\", this.windowBlurCount),\n              Str.get_string(\"integrity_recorded\", \"local_trustgrade\"),\n            ]).then((integrityStrings) => {\n              resultsHtml += `<div class=\"integrity-report alert alert-warning\">\n                <h4><i class=\"fa fa-exclamation-triangle\"></i> ${integrityStrings[0]}</h4>\n                <p>${integrityStrings[1]}</p>\n                <p><small>${integrityStrings[2]}</small></p>\n              </div>`\n              this.displayResults(resultsHtml)\n            })\n          } else {\n            this.displayResults(resultsHtml)\n          }\n        })\n      })\n    },\n\n    displayResults: (resultsHtml) => {\n      $(\".quiz-content\").hide()\n      $(\".quiz-navigation\").hide()\n      $(\".question-counter\").hide()\n      $(\".question-timer\").hide()\n      $(\".quiz-results\").html(resultsHtml).show()\n    },\n\n    showIntegrityViolation: function () {\n      this.attemptCompleted = true\n      this.stopTimer()\n      if (this.autoSaveInterval) clearInterval(this.autoSaveInterval)\n      Promise.all([\n        Str.get_string(\"integrity_violation_header\", \"local_trustgrade\"),\n        Str.get_string(\"quiz_flagged\", \"local_trustgrade\"),\n        Str.get_string(\"exceeded_window_switches\", \"local_trustgrade\", this.maxWindowBlurs),\n        Str.get_string(\"incident_logged\", \"local_trustgrade\"),\n        Str.get_string(\"progress_saved_cannot_continue\", \"local_trustgrade\"),\n      ]).then((strings) => {\n        var violationHtml = `\n          <div class=\"integrity-violation alert alert-danger\">\n            <h2><i class=\"fa fa-ban\"></i> ${strings[0]}</h2>\n            <p><strong>${strings[1]}</strong></p>\n            <p>${strings[2]}</p>\n            <p>${strings[3]}</p>\n            <p><strong>${strings[4]}</strong></p>\n          </div>\n        `\n        $(\".quiz-content\").html(violationHtml)\n        $(\".quiz-navigation\").hide()\n        $(\".question-counter\").hide()\n        $(\".question-timer\").hide()\n        this.logIntegrityViolation(\"integrity_violation\", {\n          violation_type: \"excessive_window_blur\",\n          window_blur_count: this.windowBlurCount,\n          current_question: this.currentQuestion,\n        })\n      })\n    },\n  }\n\n  return Quiz\n})\n"],"names":["define","$","Ajax","Notification","Str","session","questions","settings","cmid","submissionid","currentQuestion","answers","timer","timeRemaining","attemptStarted","attemptCompleted","windowBlurCount","maxWindowBlurs","autoSaveInterval","init","length","this","current_question","attempt_started","attempt_completed","window_blur_count","time_remaining","showResults","resumeQuiz","showIntegrityWarning","bindEvents","bindIntegrityEvents","startAutoSave","showQuestion","updateCounter","Promise","all","get_string","then","strings","warningHtml","html","hide","bindStartEvent","document","off","on","startQuizAttempt","call","methodname","args","done","response","success","message","addNotification","type","error","fail","exception","setInterval","saveSessionState","updates","JSON","stringify","validateCurrentAnswer","saveCurrentAnswer","advanceToNextQuestion","finishQuiz","updateNavigationButtons","window","logIntegrityViolation","count","showIntegrityViolation","max","e","keyCode","ctrlKey","shiftKey","preventDefault","violationType","violationData","arguments","undefined","violation_type","violation_data","getQuestionText","q","text","question","getOptionText","option","label","String","getOptionExplanation","index","options","i","Number","parseInt","isNaN","Array","isArray","explanation","explanations","key","option_explanations","getCorrectAnswerIndex","isInteger","correct_answer","opt","correct","is_correct","isCorrect","isAnswerCorrect","userAnswer","userBool","correctIndex","Math","round","current","total","progress","bloomsLevel","metadata","blooms_level","blooms","difficulty","source","points","forEach","optIndex","checked","trueChecked","falseChecked","savedAnswer","show","show_countdown","startTimer","clearInterval","time_per_question","updateTimerDisplay","stopTimer","autoAdvance","minutes","floor","seconds","timeString","timerHtml","hasAnswer","val","trim","answer","score","calculateScore","final_answers","final_score","totalPoints","resultsHtml","userAnswerText","replace","explanationText","tfExplanation","true","false","idx","percentage","scoreString","integrityStrings","displayResults","violationHtml"],"mappings":"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"}
