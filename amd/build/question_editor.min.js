var define=window.define;window.M;define("local_trustgrade/question_editor",["jquery","core/ajax","core/notification","core/str"],($,Ajax,Notification,Str)=>{var QuestionEditor={cmid:0,initialized:!1,init:function(cmid){this.cmid=cmid||0,this.initialized||(this.bindEvents(),this.initialized=!0)},bindEvents:()=>{$(document).off("click.questioneditor").off("change.questioneditor"),$(document).on("click.questioneditor",".edit-question-btn",function(e){e.preventDefault();var questionItem=$(this).closest(".editable-question-item");QuestionEditor.enterEditMode(questionItem)}),$(document).on("click.questioneditor",".cancel-edit-btn",function(e){e.preventDefault();var questionItem=$(this).closest(".editable-question-item");QuestionEditor.exitEditMode(questionItem)}),$(document).on("click.questioneditor",".save-question-btn",function(e){e.preventDefault();var questionItem=$(this).closest(".editable-question-item");QuestionEditor.saveQuestion(questionItem)}),$(document).on("click.questioneditor",".delete-question-btn",function(e){e.preventDefault();var $button=$(this);if(!$button.prop("disabled")){$button.prop("disabled",!0);var questionItem=$button.closest(".editable-question-item");setTimeout(()=>QuestionEditor.deleteQuestion(questionItem,$button),100)}}),$(document).on("change.questioneditor",".question-type-input",function(e){var questionIndex=$(this).closest(".editable-question-item").data("question-index");QuestionEditor.updateOptionsSection($(this).val(),questionIndex)})},enterEditMode:questionItem=>{questionItem.find(".question-display-mode").hide(),questionItem.find(".question-edit-mode").show()},exitEditMode:questionItem=>{questionItem.find(".question-edit-mode").hide(),questionItem.find(".question-display-mode").show()},saveQuestion:questionItem=>{var questionIndex=questionItem.data("question-index"),cmid=questionItem.data("cmid"),questionData={question:questionItem.find(".question-text-input").val(),type:questionItem.find(".question-type-input").val(),difficulty:questionItem.find(".question-difficulty-input").val(),points:Number.parseInt(questionItem.find(".question-points-input").val()),explanation:questionItem.find(".question-explanation-input").val()};if("multiple_choice"===questionData.type?(questionData.options=[],questionItem.find(".option-text-input").each(function(){questionData.options.push($(this).val())}),questionData.correct_answer=Number.parseInt(questionItem.find(".correct-answer-radio:checked").val()||0)):"true_false"===questionData.type&&(questionData.correct_answer="true"===questionItem.find('input[name^="tf_answer_"]:checked').val()),questionData.question.trim())if("multiple_choice"===questionData.type&&questionData.options.some(opt=>!opt.trim()))Str.get_string("all_options_required","local_trustgrade").then(message=>Notification.addNotification({message:message,type:"error"}));else{var $saveBtn=questionItem.find(".save-question-btn");$saveBtn.prop("disabled",!0),Ajax.call([{methodname:"local_trustgrade_save_question",args:{cmid:cmid,question_index:questionIndex,question_data:JSON.stringify(questionData)}}])[0].done(response=>{response.success?(QuestionEditor.updateQuestionDisplay(questionItem,questionData),QuestionEditor.exitEditMode(questionItem),Str.get_string("question_saved_success","local_trustgrade").then(message=>Notification.addNotification({message:message,type:"success"}))):Notification.addNotification({message:response.error||"Failed to save question.",type:"error"})}).fail(Notification.exception).always(()=>$saveBtn.prop("disabled",!1))}else Str.get_string("question_text_required","local_trustgrade").then(message=>Notification.addNotification({message:message,type:"error"}))},deleteQuestion:(questionItem,$button)=>{Promise.all([Str.get_string("confirm_delete_question_title","local_trustgrade"),Str.get_string("confirm_delete_question_message","local_trustgrade"),Str.get_string("delete","core"),Str.get_string("cancel","core")]).then(strings=>{Notification.confirm(strings[0],strings[1],strings[2],strings[3],()=>{var questionIndex=questionItem.data("question-index"),cmid=questionItem.data("cmid");QuestionEditor.performDelete(questionItem,questionIndex,cmid)},()=>$button.prop("disabled",!1))})},performDelete:(questionItem,questionIndex,cmid)=>{Ajax.call([{methodname:"local_trustgrade_delete_question",args:{cmid:cmid,question_index:questionIndex}}])[0].done(response=>{response.success?(questionItem.fadeOut(300,function(){$(this).remove(),QuestionEditor.reindexQuestions()}),Str.get_string("question_deleted_success","local_trustgrade").then(message=>Notification.addNotification({message:message,type:"success"}))):Notification.addNotification({message:response.error||"Failed to delete question.",type:"error"})}).fail(Notification.exception)},updateQuestionDisplay:(questionItem,questionData)=>{var displayMode=questionItem.find(".question-display-mode .question-content");Promise.all([Str.get_string("question","local_trustgrade"),Str.get_string("correct","local_trustgrade"),Str.get_string("explanation","local_trustgrade")]).then(strings=>{var html=`<p><strong>Type:</strong> ${questionData.type.replace("_"," ")}</p>\n                    <p><strong>Difficulty:</strong> ${questionData.difficulty}</p>\n                    <p><strong>Points:</strong> ${questionData.points}</p>\n                    <p><strong>${strings[0]}:</strong> ${questionData.question}</p>`;questionData.options&&questionData.options.length>0&&(html+="<p><strong>Options:</strong></p><ul>",questionData.options.forEach((option,index)=>{var isCorrect=questionData.correct_answer===index?` <strong>(${strings[1]})</strong>`:"";html+=`<li>${option}${isCorrect}</li>`}),html+="</ul>"),questionData.explanation&&(html+=`<p><strong>${strings[2]}:</strong> ${questionData.explanation}</p>`),displayMode.html(html)})},updateOptionsSection:(questionType,questionIndex)=>{var optionsSection=$(`.editable-question-item[data-question-index="${questionIndex}"] .question-options-section`);"multiple_choice"===questionType?optionsSection.html(QuestionEditor.generateMultipleChoiceOptions(questionIndex)):"true_false"===questionType?QuestionEditor.generateTrueFalseOptions(questionIndex).then(html=>optionsSection.html(html)):optionsSection.html("")},generateMultipleChoiceOptions:questionIndex=>{for(var html='<div class="multiple-choice-options"><label>Options:</label>',i=0;i<4;i++)html+=`<div class="option-row"><div class="form-check">\n                   <input class="form-check-input correct-answer-radio" type="radio" name="correct_answer_${questionIndex}" value="${i}" ${0===i?"checked":""}>\n                   <input type="text" class="form-control option-text-input" placeholder="Option ${String.fromCharCode(65+i)}">\n                 </div></div>`;return html+="</div>"},generateTrueFalseOptions:questionIndex=>Promise.all([Str.get_string("correct_answer","local_trustgrade"),Str.get_string("true","local_trustgrade"),Str.get_string("false","local_trustgrade")]).then(strings=>`<div class="true-false-options"><label>${strings[0]}:</label>\n                  <div class="form-check">\n                    <input class="form-check-input" type="radio" name="tf_answer_${questionIndex}" value="true" checked>\n                    <label class="form-check-label">${strings[1]}</label>\n                  </div>\n                  <div class="form-check">\n                    <input class="form-check-input" type="radio" name="tf_answer_${questionIndex}" value="false">\n                    <label class="form-check-label">${strings[2]}</label>\n                  </div>\n                </div>`),reindexQuestions:()=>{Str.get_string("question","local_trustgrade").then(str=>{$("#question-bank-container .editable-question-item").each(function(index){$(this).data("question-index",index),$(this).find(".question-header h5").text(`${str} ${index+1}`)})})},reinitialize:function(cmid){this.initialized=!1,this.init(cmid)}};return QuestionEditor});

//# sourceMappingURL=question_editor.min.js.map