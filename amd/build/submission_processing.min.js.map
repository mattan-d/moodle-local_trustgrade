{"version":3,"file":"submission_processing.min.js","sources":["../src/submission_processing.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.com\n\ndefine([\"jquery\", \"core/templates\", \"core/str\"], ($, Templates, Str) => {\n  var SubmissionProcessing = {\n    cmid: 0,\n    submissionId: 0,\n    processingOverlay: null,\n    statusCheckInterval: null,\n\n    init: function (cmid) {\n      this.cmid = cmid\n      this.bindSubmissionEvents()\n      this.bindAssignmentFormEvents()\n    },\n\n    bindSubmissionEvents: function () {\n      // Wait for DOM to be ready\n      $(document).ready(() => {\n        // Find assignment submission forms\n        var $forms = $('form[action*=\"editsubmission\"], form.mform, #region-main form')\n\n        if ($forms.length > 0) {\n          $forms.on(\"submit\", (e) => {\n            this.showProcessingMessage(\"submission\")\n            // Allow form to submit normally\n            // The processing message will be shown while the page processes\n          })\n        }\n      })\n    },\n\n    bindAssignmentFormEvents: function () {\n      $(document).ready(() => {\n        // Find assignment creation/editing forms (mod_assign forms)\n        var $assignmentForms = $('form[action*=\"modedit.php\"], form.mform[action*=\"course/modedit.php\"]')\n\n        if ($assignmentForms.length > 0) {\n          $assignmentForms.on(\"submit\", (e) => {\n            // Check if auto-generate questions is enabled\n            var $autoGenerateCheckbox = $(\"#id_trustgrade_auto_generate\")\n            var $trustgradeEnabled = $(\"#id_trustgrade_enabled\")\n\n            if (\n              $autoGenerateCheckbox.length > 0 &&\n              $autoGenerateCheckbox.is(\":checked\") &&\n              $trustgradeEnabled.length > 0 &&\n              $trustgradeEnabled.is(\":checked\")\n            ) {\n              this.showProcessingMessage(\"questions\")\n            }\n            // Allow form to submit normally\n          })\n        }\n      })\n    },\n\n    showProcessingMessage: function (type = \"submission\") {\n      var stringRequests = []\n\n      if (type === \"questions\") {\n        stringRequests = [\n          { key: \"processing_question_generation\", component: \"local_trustgrade\" },\n          { key: \"processing_question_generation_message\", component: \"local_trustgrade\" },\n        ]\n      } else {\n        stringRequests = [\n          { key: \"processing_submission\", component: \"local_trustgrade\" },\n          { key: \"processing_submission_message\", component: \"local_trustgrade\" },\n        ]\n      }\n\n      Str.get_strings(stringRequests)\n        .then((strings) => {\n          var context = {\n            title: strings[0],\n            message: strings[1],\n            spinner_class: \"fa fa-spinner fa-spin\",\n          }\n\n          return Templates.render(\"local_trustgrade/submission_processing_overlay\", context)\n        })\n        .then((html) => {\n          // Remove any existing overlay\n          $(\"#submission-processing-overlay\").remove()\n\n          // Add overlay to body\n          $(\"body\").append(html)\n\n          // Prevent scrolling\n          $(\"body\").css(\"overflow\", \"hidden\")\n        })\n        .catch((error) => {\n          console.error(\"Error rendering processing overlay:\", error)\n          // Fallback to simple overlay if template fails\n          this.showFallbackProcessingMessage(type)\n        })\n    },\n\n    showFallbackProcessingMessage: (type = \"submission\") => {\n      var overlayHtml = \"\"\n\n      if (type === \"questions\") {\n        overlayHtml =\n          '<div id=\"submission-processing-overlay\" class=\"submission-processing-overlay\">' +\n          '<div class=\"processing-modal\">' +\n          '<div class=\"spinner-container\"><i class=\"fa fa-spinner fa-spin\" aria-hidden=\"true\"></i></div>' +\n          '<h3 class=\"processing-title\">Processing Assignment...</h3>' +\n          '<p class=\"processing-message\">Please wait while we save your assignment and prepare to generate questions...</p>' +\n          \"</div></div>\"\n      } else {\n        overlayHtml =\n          '<div id=\"submission-processing-overlay\" class=\"submission-processing-overlay\">' +\n          '<div class=\"processing-modal\">' +\n          '<div class=\"spinner-container\"><i class=\"fa fa-spinner fa-spin\" aria-hidden=\"true\"></i></div>' +\n          '<h3 class=\"processing-title\">Processing...</h3>' +\n          '<p class=\"processing-message\">Please wait while we process your submission...</p>' +\n          \"</div></div>\"\n      }\n\n      $(\"#submission-processing-overlay\").remove()\n      $(\"body\").append(overlayHtml)\n      $(\"body\").css(\"overflow\", \"hidden\")\n    },\n\n    hideProcessingMessage: () => {\n      $(\"#submission-processing-overlay\").remove()\n      $(\"body\").css(\"overflow\", \"\")\n    },\n  }\n\n  return SubmissionProcessing\n})\n"],"names":["define","$","Templates","Str","cmid","submissionId","processingOverlay","statusCheckInterval","init","this","bindSubmissionEvents","bindAssignmentFormEvents","document","ready","$forms","length","on","e","showProcessingMessage","$assignmentForms","$autoGenerateCheckbox","$trustgradeEnabled","is","type","arguments","undefined","stringRequests","key","component","get_strings","then","strings","context","title","message","spinner_class","render","html","remove","append","css","catch","error","console","showFallbackProcessingMessage","overlayHtml","hideProcessingMessage"],"mappings":"AAEAA,OAAO,yCAAA,CAAC,SAAU,iBAAkB,YAAa,CAACC,EAAGC,UAAWC,OACnC,CACzBC,KAAM,EACNC,aAAc,EACdC,kBAAmB,KACnBC,oBAAqB,KAErBC,KAAM,SAAUJ,MACdK,KAAKL,KAAOA,KACZK,KAAKC,uBACLD,KAAKE,0BACN,EAEDD,qBAAsB,WAEpBT,EAAEW,UAAUC,MAAM,KAEhB,IAAIC,OAASb,EAAE,iEAEXa,OAAOC,OAAS,GAClBD,OAAOE,GAAG,SAAWC,IACnBR,KAAKS,sBAAsB,iBAMlC,EAEDP,yBAA0B,WACxBV,EAAEW,UAAUC,MAAM,KAEhB,IAAIM,iBAAmBlB,EAAE,yEAErBkB,iBAAiBJ,OAAS,GAC5BI,iBAAiBH,GAAG,SAAWC,IAE7B,IAAIG,sBAAwBnB,EAAE,gCAC1BoB,mBAAqBpB,EAAE,0BAGzBmB,sBAAsBL,OAAS,GAC/BK,sBAAsBE,GAAG,aACzBD,mBAAmBN,OAAS,GAC5BM,mBAAmBC,GAAG,aAEtBb,KAAKS,sBAAsB,gBAMpC,EAEDA,sBAAuB,WAA+B,IAArBK,KAAIC,UAAAT,OAAA,QAAAU,IAAAD,UAAA,GAAAA,UAAA,GAAG,aACtC,IAAIE,eAAiB,GAGnBA,eADW,cAATH,KACe,CACf,CAAEI,IAAK,iCAAkCC,UAAW,oBACpD,CAAED,IAAK,yCAA0CC,UAAW,qBAG7C,CACf,CAAED,IAAK,wBAAyBC,UAAW,oBAC3C,CAAED,IAAK,gCAAiCC,UAAW,qBAIvDzB,IAAI0B,YAAYH,gBACbI,KAAMC,UACL,IAAIC,QAAU,CACZC,MAAOF,QAAQ,GACfG,QAASH,QAAQ,GACjBI,cAAe,yBAGjB,OAAOjC,UAAUkC,OAAO,iDAAkDJ,WAE3EF,KAAMO,OAELpC,EAAE,kCAAkCqC,SAGpCrC,EAAE,QAAQsC,OAAOF,MAGjBpC,EAAE,QAAQuC,IAAI,WAAY,YAE3BC,MAAOC,QACNC,QAAQD,MAAM,sCAAuCA,OAErDjC,KAAKmC,8BAA8BrB,OAExC,EAEDqB,8BAA+B,WAC7B,IAAIC,YAAc,GAGhBA,YADW,eAHqBrB,UAAAT,OAAA,QAAAU,IAAAD,UAAA,GAAAA,UAAA,GAAG,cAKjC,kYAQA,wVAQJvB,EAAE,kCAAkCqC,SACpCrC,EAAE,QAAQsC,OAAOM,aACjB5C,EAAE,QAAQuC,IAAI,WAAY,SAC3B,EAEDM,sBAAuBA,KACrB7C,EAAE,kCAAkCqC,SACpCrC,EAAE,QAAQuC,IAAI,WAAY"}
