define(["jquery","core/ajax","core/notification"],function(e,t,s){"use strict";var n={init:function(e,t){this.submissionId=e,this.cmid=t,this.checkInterval=null,this.showProcessingMessage(),this.startStatusCheck()},showProcessingMessage:function(){var t='<div id="trustgrade-processing-message" class="alert alert-info"><div class="d-flex align-items-center"><div class="spinner-border spinner-border-sm me-2" role="status"><span class="sr-only">Loading...</span></div><div><strong>Processing your submission...</strong><br>Please wait while we generate questions based on your submission. This may take a few moments.</div></div></div>',s=e(".submissionstatustable, .submission-status, #assign_submission_form");s.length?s.after(t):e("#region-main .card-body, #region-main").first().prepend(t)},startStatusCheck:function(){var e=this;this.checkInterval=setInterval(function(){e.checkTaskStatus()},3e3),this.checkTaskStatus()},checkTaskStatus:function(){var t=this;e.ajax({url:M.cfg.wwwroot+"/local/trustgrade/ajax/check_task_status.php",method:"GET",data:{submission_id:this.submissionId,cmid:this.cmid,sesskey:M.cfg.sesskey},dataType:"json"}).done(function(e){t.handleStatusResponse(e)}).fail(function(){console.log("[v0] Failed to check task status")})},handleStatusResponse:function(e){"completed"===e.status?(this.showCompletedMessage(),this.stopStatusCheck(),setTimeout(function(){window.location.reload()},2e3)):"failed"===e.status&&(this.showErrorMessage(e.error_message),this.stopStatusCheck())},showCompletedMessage:function(){var t=e("#trustgrade-processing-message");t.removeClass("alert-info").addClass("alert-success"),t.html('<div class="d-flex align-items-center"><i class="fa fa-check-circle me-2 text-success"></i><div><strong>Processing completed!</strong><br>Questions have been generated. Redirecting to quiz...</div></div>')},showErrorMessage:function(t){var s=e("#trustgrade-processing-message");s.removeClass("alert-info").addClass("alert-danger"),s.html('<div class="d-flex align-items-center"><i class="fa fa-exclamation-triangle me-2 text-danger"></i><div><strong>Processing failed</strong><br>There was an error processing your submission. Please try again or contact support.'+(t?"<br><small>"+t+"</small>":"")+"</div></div>")},stopStatusCheck:function(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}};return n});
