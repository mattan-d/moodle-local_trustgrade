{"version":3,"file":"grading.min.js","sources":["../src/grading.js"],"sourcesContent":["define([\n  \"jquery\",\n  \"core/ajax\",\n  \"core/notification\",\n  \"core/config\",\n  \"core/str\",\n  \"core/modal_factory\",\n  \"core/modal_events\",\n], ($, Ajax, Notification, M, Str, ModalFactory, ModalEvents) => {\n  var pendingGrades = new Map()\n  var saveTimeout\n  var cmid\n\n  /**\n   * Initialize the grading functionality\n   * @param {int} courseModuleId Course module ID\n   */\n  function init(courseModuleId) {\n    cmid = courseModuleId || 0\n\n    // Bind event handlers\n    bindGradeInputEvents()\n    bindBulkActionEvents()\n\n    // Load current grades\n    loadCurrentGrades()\n  }\n\n  /**\n   * Bind events to grade input fields\n   */\n  function bindGradeInputEvents() {\n    $(document).on(\"input\", \".grade-input\", function () {\n      var $input = $(this)\n      var userid = $input.data(\"userid\")\n      var grade = $input.val()\n\n      // Mark as pending\n      pendingGrades.set(userid, grade)\n      updateGradeStatus($input, \"pending\")\n      updatePendingGradesDisplay()\n\n      // Clear existing timeout\n      if (saveTimeout) {\n        clearTimeout(saveTimeout)\n      }\n\n      // Set new timeout for auto-save\n      saveTimeout = setTimeout(() => {\n        saveGrade(userid, grade, $input)\n      }, 2000)\n    })\n\n    $(document).on(\"blur\", \".grade-input\", function () {\n      var $input = $(this)\n      var userid = $input.data(\"userid\")\n      var grade = $input.val()\n\n      // Save immediately on blur\n      if (pendingGrades.has(userid)) {\n        if (saveTimeout) {\n          clearTimeout(saveTimeout)\n        }\n        saveGrade(userid, grade, $input)\n      }\n    })\n\n    $(document).on(\"keypress\", \".grade-input\", function (e) {\n      if (e.which === 13) {\n        // Enter key\n        var $input = $(this)\n        var userid = $input.data(\"userid\")\n        var grade = $input.val()\n\n        if (saveTimeout) {\n          clearTimeout(saveTimeout)\n        }\n        saveGrade(userid, grade, $input)\n      }\n    })\n  }\n\n  /**\n   * Bind bulk action events\n   */\n  function bindBulkActionEvents() {\n    $(\"#bulk-save-grades\").on(\"click\", () => {\n      savePendingGrades()\n    })\n\n    $(\"#clear-all-grades\").on(\"click\", () => {\n      showClearAllGradesModal()\n    })\n\n    $(\"#auto-grade-by-quiz\").on(\"click\", () => {\n      showAutoGradeModal()\n    })\n  }\n\n  /**\n   * Show confirmation modal for clearing all grades\n   */\n  function showClearAllGradesModal() {\n    ModalFactory.create({\n      type: ModalFactory.types.SAVE_CANCEL,\n      title: Str.get_string(\"confirm_clear_all_grades\", \"local_trustgrade\"),\n      body: Str.get_string(\"confirm_clear_all_grades_body\", \"local_trustgrade\"),\n    })\n      .then((modal) => {\n        modal.setSaveButtonText(Str.get_string(\"clear_all_grades\", \"local_trustgrade\"))\n        modal.getRoot().on(ModalEvents.save, () => {\n          clearAllGrades()\n        })\n        modal.show()\n        return modal\n      })\n      .catch(() => {\n        // Fallback to native confirm if modal fails\n        if (confirm(\"Are you sure you want to clear all grades? This action cannot be undone.\")) {\n          clearAllGrades()\n        }\n      })\n  }\n\n  /**\n   * Show confirmation modal for auto-grading\n   */\n  function showAutoGradeModal() {\n    ModalFactory.create({\n      type: ModalFactory.types.SAVE_CANCEL,\n      title: Str.get_string(\"auto_grade_by_quiz\", \"local_trustgrade\"),\n      body: Str.get_string(\"auto_grade_confirmation\", \"local_trustgrade\"),\n    })\n      .then((modal) => {\n        modal.setSaveButtonText(Str.get_string(\"auto_grade_by_quiz\", \"local_trustgrade\"))\n        modal.getRoot().on(ModalEvents.save, () => {\n          autoGradeByQuizScore()\n        })\n        modal.show()\n        return modal\n      })\n      .catch(() => {\n        // Fallback to native confirm if modal fails\n        if (\n          confirm(\n            \"This will automatically set grades based on quiz scores for all students. Existing grades will be overwritten. Continue?\",\n          )\n        ) {\n          autoGradeByQuizScore()\n        }\n      })\n  }\n\n  /**\n   * Save a single grade\n   * @param {int} userid User ID\n   * @param {string} grade Grade value\n   * @param {jQuery} $input Input element\n   */\n  function saveGrade(userid, grade, $input) {\n    updateGradeStatus($input, \"saving\")\n\n    var promise = Ajax.call([\n      {\n        methodname: \"local_trustgrade_save_grade\",\n        args: {\n          cmid: cmid,\n          userid: userid,\n          grade: grade,\n        },\n      },\n    ])[0]\n\n    promise\n      .done((response) => {\n        if (response.success) {\n          updateGradeStatus($input, \"saved\")\n          pendingGrades.delete(userid)\n          updatePendingGradesDisplay()\n\n          // Update display with formatted grade\n          if (response.formatted_grade) {\n            $input.val(response.formatted_grade)\n          }\n        } else {\n          updateGradeStatus($input, \"error\")\n          Str.get_string(\"error_saving_grade_user\", \"local_trustgrade\", userid)\n            .then((errorText) => {\n              Notification.addNotification({\n                message: errorText + \": \" + (response.message || \"Unknown error\"),\n                type: \"error\",\n              })\n            })\n            .catch(() => {\n              Notification.addNotification({\n                message: \"Error saving grade for user \" + userid + \": \" + (response.message || \"Unknown error\"),\n                type: \"error\",\n              })\n            })\n        }\n      })\n      .fail((ex) => {\n        updateGradeStatus($input, \"error\")\n        Notification.exception(ex)\n      })\n  }\n\n  /**\n   * Save all pending grades\n   */\n  function savePendingGrades() {\n    if (pendingGrades.size === 0) {\n      Str.get_string(\"no_pending_grades\", \"local_trustgrade\")\n        .then((message) => {\n          Notification.addNotification({\n            message: message,\n            type: \"info\",\n          })\n        })\n        .catch(() => {\n          Notification.addNotification({\n            message: \"No pending grades to save.\",\n            type: \"info\",\n          })\n        })\n      return\n    }\n\n    var $button = $(\"#bulk-save-grades\")\n    Str.get_string(\"saving_grades\", \"local_trustgrade\")\n      .then((savingText) => {\n        $button.prop(\"disabled\", true).html('<i class=\"fa fa-spinner fa-spin\"></i> ' + savingText)\n      })\n      .catch(() => {\n        $button.prop(\"disabled\", true).html('<i class=\"fa fa-spinner fa-spin\"></i> Saving...')\n      })\n\n    // Convert Map to object for JSON encoding\n    var gradesObject = {}\n    pendingGrades.forEach((grade, userid) => {\n      gradesObject[userid] = grade\n    })\n\n    var promise = Ajax.call([\n      {\n        methodname: \"local_trustgrade_save_bulk_grades\",\n        args: {\n          cmid: cmid,\n          grades: JSON.stringify(gradesObject),\n        },\n      },\n    ])[0]\n\n    promise\n      .done((response) => {\n        if (response.success) {\n          // Clear pending grades and update status\n          pendingGrades.forEach((grade, userid) => {\n            var $input = $(\"#grade_\" + userid)\n            updateGradeStatus($input, \"saved\")\n\n            setTimeout(() => {\n              updateGradeStatus($input, \"\")\n            }, 3000)\n          })\n\n          pendingGrades.clear()\n          updatePendingGradesDisplay()\n\n          Str.get_string(\"grades_saved_success\", \"local_trustgrade\", response.saved_count)\n            .then((message) => {\n              Notification.addNotification({\n                message: message,\n                type: \"success\",\n              })\n            })\n            .catch(() => {\n              Notification.addNotification({\n                message: response.saved_count + \" grades saved successfully\",\n                type: \"success\",\n              })\n            })\n        } else {\n          Str.get_string(\"error_saving_grades\", \"local_trustgrade\")\n            .then((errorText) => {\n              Notification.addNotification({\n                message: response.message || errorText,\n                type: \"error\",\n              })\n            })\n            .catch(() => {\n              Notification.addNotification({\n                message: response.message || \"Error saving grades\",\n                type: \"error\",\n              })\n            })\n        }\n      })\n      .fail(Notification.exception)\n      .always(() => {\n        Str.get_string(\"save_all_pending\", \"local_trustgrade\")\n          .then((buttonText) => {\n            $button.prop(\"disabled\", false).html('<i class=\"fa fa-save\"></i> ' + buttonText)\n          })\n          .catch(() => {\n            $button.prop(\"disabled\", false).html('<i class=\"fa fa-save\"></i> Save All Pending')\n          })\n      })\n  }\n\n  /**\n   * Clear all grades\n   */\n  function clearAllGrades() {\n    var $button = $(\"#clear-all-grades\")\n    Str.get_string(\"clearing_grades\", \"local_trustgrade\")\n      .then((clearingText) => {\n        $button.prop(\"disabled\", true).html('<i class=\"fa fa-spinner fa-spin\"></i> ' + clearingText)\n      })\n      .catch(() => {\n        $button.prop(\"disabled\", true).html('<i class=\"fa fa-spinner fa-spin\"></i> Clearing...')\n      })\n\n    var promise = Ajax.call([\n      {\n        methodname: \"local_trustgrade_clear_all_grades\",\n        args: {\n          cmid: cmid,\n        },\n      },\n    ])[0]\n\n    promise\n      .done((response) => {\n        if (response.success) {\n          // Clear all input fields\n          $(\".grade-input\")\n            .val(\"\")\n            .each(function () {\n              updateGradeStatus($(this), \"\")\n            })\n\n          // Clear pending grades\n          pendingGrades.clear()\n          updatePendingGradesDisplay()\n\n          Str.get_string(\"all_grades_cleared\", \"local_trustgrade\")\n            .then((message) => {\n              Notification.addNotification({\n                message: message,\n                type: \"success\",\n              })\n            })\n            .catch(() => {\n              Notification.addNotification({\n                message: \"All grades cleared successfully\",\n                type: \"success\",\n              })\n            })\n        } else {\n          Str.get_string(\"error_clearing_grades\", \"local_trustgrade\")\n            .then((errorText) => {\n              Notification.addNotification({\n                message: response.message || errorText,\n                type: \"error\",\n              })\n            })\n            .catch(() => {\n              Notification.addNotification({\n                message: response.message || \"Error clearing grades\",\n                type: \"error\",\n              })\n            })\n        }\n      })\n      .fail(Notification.exception)\n      .always(() => {\n        Str.get_string(\"clear_all_grades\", \"local_trustgrade\")\n          .then((buttonText) => {\n            $button.prop(\"disabled\", false).html('<i class=\"fa fa-eraser\"></i> ' + buttonText)\n          })\n          .catch(() => {\n            $button.prop(\"disabled\", false).html('<i class=\"fa fa-eraser\"></i> Clear All Grades')\n          })\n      })\n  }\n\n  /**\n   * Auto-grade all students based on their quiz scores\n   */\n  function autoGradeByQuizScore() {\n    var $button = $(\"#auto-grade-by-quiz\")\n\n    Str.get_string(\"auto_grading_progress\", \"local_trustgrade\")\n      .then((loadingText) => {\n        $button.prop(\"disabled\", true).html('<i class=\"fa fa-spinner fa-spin\"></i> ' + loadingText)\n      })\n      .catch(() => {\n        // Fallback if string loading fails\n        $button.prop(\"disabled\", true).html('<i class=\"fa fa-spinner fa-spin\"></i> Auto-grading...')\n      })\n\n    var promise = Ajax.call([\n      {\n        methodname: \"local_trustgrade_auto_grade_by_quiz\",\n        args: {\n          cmid: cmid,\n        },\n      },\n    ])[0]\n\n    promise\n      .done((response) => {\n        if (response.success) {\n          // Parse the JSON grades string\n          var gradesObj = {}\n          try {\n            if (response.grades) {\n              gradesObj = JSON.parse(response.grades)\n            }\n          } catch (e) {\n            Str.get_string(\"error_parsing_grades\", \"local_trustgrade\")\n              .then((errorText) => {\n                console.error(errorText + \":\", e)\n              })\n              .catch(() => {\n                console.error(\"Error parsing grades JSON:\", e)\n              })\n            gradesObj = {}\n          }\n\n          // Update all grade inputs with the new grades\n          for (var userid in gradesObj) {\n            if (gradesObj.hasOwnProperty(userid)) {\n              var $input = $(\"#grade_\" + userid)\n              var grade = gradesObj[userid]\n              if (grade !== null && grade !== undefined) {\n                $input.val(Number.parseFloat(grade).toFixed(2))\n                updateGradeStatus($input, \"saved\")\n\n                // Clear the saved status after a few seconds\n                setTimeout(() => {\n                  updateGradeStatus($input, \"\")\n                }, 3000)\n              }\n            }\n          }\n\n          // Clear any pending grades since we just applied auto-grades\n          pendingGrades.clear()\n          updatePendingGradesDisplay()\n\n          Str.get_string(\"auto_grade_success\", \"local_trustgrade\", response.graded_count)\n            .then((successText) => {\n              Notification.addNotification({\n                message: successText,\n                type: \"success\",\n              })\n            })\n            .catch(() => {\n              // Fallback if string loading fails\n              Notification.addNotification({\n                message: response.graded_count + \" students auto-graded based on quiz scores\",\n                type: \"success\",\n              })\n            })\n        } else {\n          Str.get_string(\"auto_grade_error\", \"local_trustgrade\")\n            .then((errorText) => {\n              Notification.addNotification({\n                message: response.message || errorText.replace(\"{$a}\", \"students\"),\n                type: \"error\",\n              })\n            })\n            .catch(() => {\n              Notification.addNotification({\n                message: response.message || \"Error auto-grading students\",\n                type: \"error\",\n              })\n            })\n        }\n      })\n      .fail(Notification.exception)\n      .always(() => {\n        Str.get_string(\"auto_grade_button_text\", \"local_trustgrade\")\n          .then((buttonText) => {\n            $button.prop(\"disabled\", false).html('<i class=\"fa fa-magic\"></i> ' + buttonText)\n          })\n          .catch(() => {\n            $button.prop(\"disabled\", false).html('<i class=\"fa fa-magic\"></i> Auto-grade by Quiz Score')\n          })\n      })\n  }\n\n  /**\n   * Load current grades from server\n   */\n  function loadCurrentGrades() {\n    var userids = []\n    $(\".grade-input\").each(function () {\n      userids.push($(this).data(\"userid\"))\n    })\n\n    if (userids.length === 0) {\n      return\n    }\n\n    var promise = Ajax.call([\n      {\n        methodname: \"local_trustgrade_get_current_grades\",\n        args: {\n          cmid: cmid,\n          userids: userids,\n        },\n      },\n    ])[0]\n\n    promise\n      .done((response) => {\n        if (response.success && response.grades) {\n          // Parse the JSON grades string\n          var gradesObj = {}\n          try {\n            gradesObj = JSON.parse(response.grades)\n          } catch (e) {\n            console.error(\"Error parsing grades JSON:\", e)\n            return\n          }\n\n          for (var userid in gradesObj) {\n            if (gradesObj.hasOwnProperty(userid)) {\n              var $input = $(\"#grade_\" + userid)\n              var grade = gradesObj[userid]\n              if (grade !== null && grade !== undefined) {\n                $input.val(Number.parseFloat(grade).toFixed(2))\n                updateGradeStatus($input, \"saved\")\n              }\n            }\n          }\n        }\n      })\n      .fail(() => {\n        // Silently fail - grades will show as empty\n      })\n  }\n\n  /**\n   * Update grade status icon\n   * @param {jQuery} $input Input element\n   * @param {string} status Status: pending, saving, saved, error\n   */\n  function updateGradeStatus($input, status) {\n    var $icon = $input.siblings(\".input-group-append\").find(\".grade-status-icon\")\n\n    $icon.removeClass(\"text-warning text-primary text-success text-danger\")\n    $icon.html(\"\")\n\n    switch (status) {\n      case \"pending\":\n        $icon.addClass(\"text-warning\").html('<i class=\"fa fa-clock-o\"></i>')\n        Str.get_string(\"grade_pending_save\", \"local_trustgrade\")\n          .then((title) => {\n            $icon.attr(\"title\", title)\n          })\n          .catch(() => {\n            $icon.attr(\"title\", \"Grade pending save\")\n          })\n        break\n      case \"saving\":\n        $icon.addClass(\"text-primary\").html('<i class=\"fa fa-spinner fa-spin\"></i>')\n        Str.get_string(\"saving_grade\", \"local_trustgrade\")\n          .then((title) => {\n            $icon.attr(\"title\", title)\n          })\n          .catch(() => {\n            $icon.attr(\"title\", \"Saving grade...\")\n          })\n        break\n      case \"saved\":\n        $icon.addClass(\"text-success\").html('<i class=\"fa fa-check\"></i>')\n        Str.get_string(\"grade_saved\", \"local_trustgrade\")\n          .then((title) => {\n            $icon.attr(\"title\", title)\n          })\n          .catch(() => {\n            $icon.attr(\"title\", \"Grade saved\")\n          })\n        break\n      case \"error\":\n        $icon.addClass(\"text-danger\").html('<i class=\"fa fa-exclamation-triangle\"></i>')\n        Str.get_string(\"error_saving_grade\", \"local_trustgrade\")\n          .then((title) => {\n            $icon.attr(\"title\", title)\n          })\n          .catch(() => {\n            $icon.attr(\"title\", \"Error saving grade\")\n          })\n        break\n    }\n  }\n\n  /**\n   * Update pending grades count display\n   */\n  function updatePendingGradesDisplay() {\n    var count = pendingGrades.size\n    var $counter = $(\"#pending-grades-count\")\n    var $bulkButton = $(\"#bulk-save-grades\")\n\n    if (count > 0) {\n      Str.get_string(\"unsaved_changes\", \"local_trustgrade\", count)\n        .then((text) => {\n          $counter.text(text).show()\n        })\n        .catch(() => {\n          $counter.text(count + \" unsaved change\" + (count === 1 ? \"\" : \"s\")).show()\n        })\n      $bulkButton.show()\n    } else {\n      $counter.hide()\n      $bulkButton.hide()\n    }\n  }\n\n  return {\n    init: init,\n  }\n})\n"],"names":["define","$","Ajax","Notification","M","Str","ModalFactory","ModalEvents","saveTimeout","cmid","pendingGrades","Map","saveGrade","userid","grade","$input","updateGradeStatus","call","methodname","args","done","response","success","delete","updatePendingGradesDisplay","formatted_grade","val","get_string","then","errorText","addNotification","message","type","catch","fail","ex","exception","clearAllGrades","$button","clearingText","prop","html","each","this","clear","always","buttonText","autoGradeByQuizScore","loadingText","gradesObj","grades","JSON","parse","e","console","error","hasOwnProperty","Number","parseFloat","toFixed","setTimeout","graded_count","successText","replace","status","$icon","siblings","find","removeClass","addClass","title","attr","count","size","$counter","$bulkButton","text","show","hide","init","courseModuleId","document","on","data","set","clearTimeout","has","which","savingText","gradesObject","forEach","stringify","saved_count","savePendingGrades","create","types","SAVE_CANCEL","body","modal","setSaveButtonText","getRoot","save","confirm","userids","push","length","loadCurrentGrades"],"mappings":"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"}