{"version":3,"file":"grading.min.js","sources":["../src/grading.js"],"sourcesContent":["define([\n  \"jquery\",\n  \"core/ajax\",\n  \"core/notification\",\n  \"core/config\",\n  \"core/str\",\n  \"core/modal_factory\",\n  \"core/modal_events\",\n], ($, Ajax, Notification, M, Str, ModalFactory, ModalEvents) => {\n  var pendingGrades = new Map()\n  var saveTimeout\n  var cmid\n\n  /**\n   * Initialize the grading functionality\n   * @param {int} courseModuleId Course module ID\n   */\n  function init(courseModuleId) {\n    cmid = courseModuleId || 0\n\n    // Bind event handlers\n    bindGradeInputEvents()\n    bindBulkActionEvents()\n\n    // Load current grades\n    loadCurrentGrades()\n  }\n\n  /**\n   * Bind events to grade input fields\n   */\n  function bindGradeInputEvents() {\n    $(document).on(\"input\", \".grade-input\", function () {\n      var $input = $(this)\n      var userid = $input.data(\"userid\")\n      var grade = $input.val()\n\n      // Mark as pending\n      pendingGrades.set(userid, grade)\n      updateGradeStatus($input, \"pending\")\n      updatePendingGradesDisplay()\n\n      // Clear existing timeout\n      if (saveTimeout) {\n        clearTimeout(saveTimeout)\n      }\n\n      // Set new timeout for auto-save\n      saveTimeout = setTimeout(() => {\n        saveGrade(userid, grade, $input)\n      }, 2000)\n    })\n\n    $(document).on(\"blur\", \".grade-input\", function () {\n      var $input = $(this)\n      var userid = $input.data(\"userid\")\n      var grade = $input.val()\n\n      // Save immediately on blur\n      if (pendingGrades.has(userid)) {\n        if (saveTimeout) {\n          clearTimeout(saveTimeout)\n        }\n        saveGrade(userid, grade, $input)\n      }\n    })\n\n    $(document).on(\"keypress\", \".grade-input\", function (e) {\n      if (e.which === 13) {\n        // Enter key\n        var $input = $(this)\n        var userid = $input.data(\"userid\")\n        var grade = $input.val()\n\n        if (saveTimeout) {\n          clearTimeout(saveTimeout)\n        }\n        saveGrade(userid, grade, $input)\n      }\n    })\n  }\n\n  /**\n   * Bind bulk action events\n   */\n  function bindBulkActionEvents() {\n    $(\"#bulk-save-grades\").on(\"click\", () => {\n      savePendingGrades()\n    })\n\n    $(\"#clear-all-grades\").on(\"click\", () => {\n      showClearAllGradesModal()\n    })\n\n    $(\"#auto-grade-by-quiz\").on(\"click\", () => {\n      showAutoGradeModal()\n    })\n  }\n\n  /**\n   * Show confirmation modal for clearing all grades\n   */\n  function showClearAllGradesModal() {\n    ModalFactory.create({\n      type: ModalFactory.types.SAVE_CANCEL,\n      title: Str.get_string(\"confirm_clear_all_grades\", \"local_trustgrade\"),\n      body: Str.get_string(\"confirm_clear_all_grades_body\", \"local_trustgrade\"),\n    })\n      .then((modal) => {\n        modal.setSaveButtonText(Str.get_string(\"clear_all_grades\", \"local_trustgrade\"))\n        modal.getRoot().on(ModalEvents.save, () => {\n          clearAllGrades()\n        })\n        modal.show()\n        return modal\n      })\n      .catch(() => {\n        // Fallback to native confirm if modal fails\n        if (confirm(\"Are you sure you want to clear all grades? This action cannot be undone.\")) {\n          clearAllGrades()\n        }\n      })\n  }\n\n  /**\n   * Show confirmation modal for auto-grading\n   */\n  function showAutoGradeModal() {\n    ModalFactory.create({\n      type: ModalFactory.types.SAVE_CANCEL,\n      title: Str.get_string(\"auto_grade_by_quiz\", \"local_trustgrade\"),\n      body: Str.get_string(\"auto_grade_confirmation\", \"local_trustgrade\"),\n    })\n      .then((modal) => {\n        modal.setSaveButtonText(Str.get_string(\"auto_grade_by_quiz\", \"local_trustgrade\"))\n        modal.getRoot().on(ModalEvents.save, () => {\n          autoGradeByQuizScore()\n        })\n        modal.show()\n        return modal\n      })\n      .catch(() => {\n        // Fallback to native confirm if modal fails\n        if (\n          confirm(\n            \"This will automatically set grades based on quiz scores for all students. Existing grades will be overwritten. Continue?\",\n          )\n        ) {\n          autoGradeByQuizScore()\n        }\n      })\n  }\n\n  /**\n   * Save a single grade\n   * @param {int} userid User ID\n   * @param {string} grade Grade value\n   * @param {jQuery} $input Input element\n   */\n  function saveGrade(userid, grade, $input) {\n    updateGradeStatus($input, \"saving\")\n\n    var promise = Ajax.call([\n      {\n        methodname: \"local_trustgrade_save_grade\",\n        args: {\n          cmid: cmid,\n          userid: userid,\n          grade: grade,\n        },\n      },\n    ])[0]\n\n    promise\n      .done((response) => {\n        if (response.success) {\n          updateGradeStatus($input, \"saved\")\n          pendingGrades.delete(userid)\n          updatePendingGradesDisplay()\n\n          // Update display with formatted grade\n          if (response.formatted_grade) {\n            $input.val(response.formatted_grade)\n          }\n        } else {\n          updateGradeStatus($input, \"error\")\n          Notification.addNotification({\n            message: \"Error saving grade for user \" + userid + \": \" + (response.message || \"Unknown error\"),\n            type: \"error\",\n          })\n        }\n      })\n      .fail((ex) => {\n        updateGradeStatus($input, \"error\")\n        Notification.exception(ex)\n      })\n  }\n\n  /**\n   * Save all pending grades\n   */\n  function savePendingGrades() {\n    if (pendingGrades.size === 0) {\n      Notification.addNotification({\n        message: \"No pending grades to save.\",\n        type: \"info\",\n      })\n      return\n    }\n\n    var $button = $(\"#bulk-save-grades\")\n    $button.prop(\"disabled\", true).html('<i class=\"fa fa-spinner fa-spin\"></i> Saving...')\n\n    // Convert Map to object for JSON encoding\n    var gradesObject = {}\n    pendingGrades.forEach((grade, userid) => {\n      gradesObject[userid] = grade\n    })\n\n    var promise = Ajax.call([\n      {\n        methodname: \"local_trustgrade_save_bulk_grades\",\n        args: {\n          cmid: cmid,\n          grades: JSON.stringify(gradesObject),\n        },\n      },\n    ])[0]\n\n    promise\n      .done((response) => {\n        if (response.success) {\n          // Clear pending grades and update status\n          pendingGrades.forEach((grade, userid) => {\n            var $input = $(\"#grade_\" + userid)\n            updateGradeStatus($input, \"saved\")\n\n            setTimeout(() => {\n              updateGradeStatus($input, \"\")\n            }, 3000)\n          })\n\n          pendingGrades.clear()\n          updatePendingGradesDisplay()\n\n          Notification.addNotification({\n            message: response.saved_count + \" grades saved successfully\",\n            type: \"success\",\n          })\n        } else {\n          Notification.addNotification({\n            message: response.message || \"Error saving grades\",\n            type: \"error\",\n          })\n        }\n      })\n      .fail(Notification.exception)\n      .always(() => {\n        $button.prop(\"disabled\", false).html('<i class=\"fa fa-save\"></i> Save All Pending')\n      })\n  }\n\n  /**\n   * Clear all grades\n   */\n  function clearAllGrades() {\n    var $button = $(\"#clear-all-grades\")\n    $button.prop(\"disabled\", true).html('<i class=\"fa fa-spinner fa-spin\"></i> Clearing...')\n\n    var promise = Ajax.call([\n      {\n        methodname: \"local_trustgrade_clear_all_grades\",\n        args: {\n          cmid: cmid,\n        },\n      },\n    ])[0]\n\n    promise\n      .done((response) => {\n        if (response.success) {\n          // Clear all input fields\n          $(\".grade-input\")\n            .val(\"\")\n            .each(function () {\n              updateGradeStatus($(this), \"\")\n            })\n\n          // Clear pending grades\n          pendingGrades.clear()\n          updatePendingGradesDisplay()\n\n          Notification.addNotification({\n            message: \"All grades cleared successfully\",\n            type: \"success\",\n          })\n        } else {\n          Notification.addNotification({\n            message: response.message || \"Error clearing grades\",\n            type: \"error\",\n          })\n        }\n      })\n      .fail(Notification.exception)\n      .always(() => {\n        $button.prop(\"disabled\", false).html('<i class=\"fa fa-eraser\"></i> Clear All Grades')\n      })\n  }\n\n  /**\n   * Auto-grade all students based on their quiz scores\n   */\n  function autoGradeByQuizScore() {\n    var $button = $(\"#auto-grade-by-quiz\")\n    $button.prop(\"disabled\", true).html('<i class=\"fa fa-spinner fa-spin\"></i> Auto-grading...')\n\n    var promise = Ajax.call([\n      {\n        methodname: \"local_trustgrade_auto_grade_by_quiz\",\n        args: {\n          cmid: cmid,\n        },\n      },\n    ])[0]\n\n    promise\n      .done((response) => {\n        if (response.success) {\n          // Parse the JSON grades string\n          var gradesObj = {}\n          try {\n            if (response.grades) {\n              gradesObj = JSON.parse(response.grades)\n            }\n          } catch (e) {\n            console.error(\"Error parsing grades JSON:\", e)\n            gradesObj = {}\n          }\n\n          // Update all grade inputs with the new grades\n          for (var userid in gradesObj) {\n            if (gradesObj.hasOwnProperty(userid)) {\n              var $input = $(\"#grade_\" + userid)\n              var grade = gradesObj[userid]\n              if (grade !== null && grade !== undefined) {\n                $input.val(Number.parseFloat(grade).toFixed(2))\n                updateGradeStatus($input, \"saved\")\n\n                // Clear the saved status after a few seconds\n                setTimeout(() => {\n                  updateGradeStatus($input, \"\")\n                }, 3000)\n              }\n            }\n          }\n\n          // Clear any pending grades since we just applied auto-grades\n          pendingGrades.clear()\n          updatePendingGradesDisplay()\n\n          Notification.addNotification({\n            message: response.graded_count + \" students auto-graded based on quiz scores\",\n            type: \"success\",\n          })\n        } else {\n          Notification.addNotification({\n            message: response.message || \"Error auto-grading students\",\n            type: \"error\",\n          })\n        }\n      })\n      .fail(Notification.exception)\n      .always(() => {\n        $button.prop(\"disabled\", false).html('<i class=\"fa fa-magic\"></i> Auto-grade by Quiz Score')\n      })\n  }\n\n  /**\n   * Load current grades from server\n   */\n  function loadCurrentGrades() {\n    var userids = []\n    $(\".grade-input\").each(function () {\n      userids.push($(this).data(\"userid\"))\n    })\n\n    if (userids.length === 0) {\n      return\n    }\n\n    var promise = Ajax.call([\n      {\n        methodname: \"local_trustgrade_get_current_grades\",\n        args: {\n          cmid: cmid,\n          userids: userids,\n        },\n      },\n    ])[0]\n\n    promise\n      .done((response) => {\n        if (response.success && response.grades) {\n          // Parse the JSON grades string\n          var gradesObj = {}\n          try {\n            gradesObj = JSON.parse(response.grades)\n          } catch (e) {\n            console.error(\"Error parsing grades JSON:\", e)\n            return\n          }\n\n          for (var userid in gradesObj) {\n            if (gradesObj.hasOwnProperty(userid)) {\n              var $input = $(\"#grade_\" + userid)\n              var grade = gradesObj[userid]\n              if (grade !== null && grade !== undefined) {\n                $input.val(Number.parseFloat(grade).toFixed(2))\n                updateGradeStatus($input, \"saved\")\n              }\n            }\n          }\n        }\n      })\n      .fail(() => {\n        // Silently fail - grades will show as empty\n      })\n  }\n\n  /**\n   * Update grade status icon\n   * @param {jQuery} $input Input element\n   * @param {string} status Status: pending, saving, saved, error\n   */\n  function updateGradeStatus($input, status) {\n    var $icon = $input.siblings(\".input-group-append\").find(\".grade-status-icon\")\n\n    $icon.removeClass(\"text-warning text-primary text-success text-danger\")\n    $icon.html(\"\")\n\n    switch (status) {\n      case \"pending\":\n        $icon.addClass(\"text-warning\").html('<i class=\"fa fa-clock-o\"></i>')\n        $icon.attr(\"title\", \"Grade pending save\")\n        break\n      case \"saving\":\n        $icon.addClass(\"text-primary\").html('<i class=\"fa fa-spinner fa-spin\"></i>')\n        $icon.attr(\"title\", \"Saving grade...\")\n        break\n      case \"saved\":\n        $icon.addClass(\"text-success\").html('<i class=\"fa fa-check\"></i>')\n        $icon.attr(\"title\", \"Grade saved\")\n        break\n      case \"error\":\n        $icon.addClass(\"text-danger\").html('<i class=\"fa fa-exclamation-triangle\"></i>')\n        $icon.attr(\"title\", \"Error saving grade\")\n        break\n    }\n  }\n\n  /**\n   * Update pending grades count display\n   */\n  function updatePendingGradesDisplay() {\n    var count = pendingGrades.size\n    var $counter = $(\"#pending-grades-count\")\n    var $bulkButton = $(\"#bulk-save-grades\")\n\n    if (count > 0) {\n      $counter.text(count + \" unsaved change\" + (count === 1 ? \"\" : \"s\")).show()\n      $bulkButton.show()\n    } else {\n      $counter.hide()\n      $bulkButton.hide()\n    }\n  }\n\n  return {\n    init: init,\n  }\n})\n"],"names":["define","$","Ajax","Notification","M","Str","ModalFactory","ModalEvents","saveTimeout","cmid","pendingGrades","Map","saveGrade","userid","grade","$input","updateGradeStatus","call","methodname","args","done","response","success","delete","updatePendingGradesDisplay","formatted_grade","val","addNotification","message","type","fail","ex","exception","clearAllGrades","$button","prop","html","each","this","clear","always","autoGradeByQuizScore","gradesObj","grades","JSON","parse","e","console","error","hasOwnProperty","Number","parseFloat","toFixed","setTimeout","graded_count","status","$icon","siblings","find","removeClass","addClass","attr","count","size","$counter","$bulkButton","text","show","hide","init","courseModuleId","document","on","data","set","clearTimeout","has","which","gradesObject","forEach","stringify","saved_count","savePendingGrades","create","types","SAVE_CANCEL","title","get_string","body","then","modal","setSaveButtonText","getRoot","save","catch","confirm","userids","push","length","loadCurrentGrades"],"mappings":"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"}