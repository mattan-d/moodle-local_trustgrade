{"version":3,"file":"question_bank_button.min.js","sources":["../src/question_bank_button.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n\nvar define = window.define\nvar M = window.M\n\ndefine([\"jquery\", \"core/str\"], ($, Str) => {\n  var QuestionBankButton = {\n    init: function (cmid) {\n      this.cmid = cmid || 0\n\n      if (this.cmid > 0) {\n        this.addQuestionBankButton()\n      }\n    },\n\n    addQuestionBankButton: function () {\n      \n\n      // Try immediately first\n      this.tryAddButton()\n\n      // Also try after DOM is ready\n      $(document).ready(() => {\n        this.tryAddButton()\n      })\n\n      // Fallback: retry after a short delay to handle race conditions\n      setTimeout(() => {\n        this.tryAddButton()\n      }, 500)\n\n      // Final fallback: retry after longer delay for slow-loading pages\n      setTimeout(() => {\n        this.tryAddButton()\n      }, 2000)\n    },\n\n    tryAddButton: function () {\n      // Don't add if button already exists\n      if (document.querySelector(\".ai-question-bank-button\")) {\n        return\n      }\n\n      var questionBankUrl = M.cfg.wwwroot + \"/local/trustgrade/question_bank.php?cmid=\" + this.cmid\n\n      Str.get_string(\"question_bank\", \"local_trustgrade\")\n        .then((buttonText) => {\n          this.createButton(questionBankUrl, buttonText)\n        })\n        .catch(() => {\n          // Fallback to English\n          this.createButton(questionBankUrl, \"Question Bank\")\n        })\n    },\n\n    createButton: (url, buttonText) => {\n      if (document.querySelector(\".ai-question-bank-button\")) {\n        return\n      }\n\n      var questionBankButton = document.createElement(\"a\")\n      questionBankButton.href = url\n      questionBankButton.className = \"btn btn-secondary\"\n      questionBankButton.innerHTML = '<i class=\"fa fa-question-circle\"></i> ' + buttonText\n\n      var buttonContainer = document.createElement(\"div\")\n      buttonContainer.className = \"navitem ai-question-bank-button\"\n      buttonContainer.appendChild(questionBankButton)\n\n      var actionMenu = document.querySelector(\".tertiary-navigation\")\n      var submissionLinks = document.querySelector(\".navitem\")\n      var existingReportButton = document.querySelector(\".ai-quiz-report-button\")\n\n      var targetContainer = null\n      var insertMethod = \"append\" // 'append', 'prepend', 'after', 'before'\n      var referenceElement = null\n\n      if (existingReportButton && (submissionLinks || actionMenu)) {\n        // Preferred: Insert after quiz report button\n        targetContainer = existingReportButton.parentNode\n        insertMethod = \"after\"\n        referenceElement = existingReportButton\n      } else if (actionMenu) {\n        // Fallback 1: Add to tertiary navigation\n        targetContainer = actionMenu\n        insertMethod = \"append\"\n      } else if (submissionLinks) {\n        // Fallback 2: Add to navitem container\n        targetContainer = submissionLinks.parentNode || submissionLinks\n        insertMethod = \"append\"\n      } else {\n        // Fallback 3: Try to find any navigation container\n        var navContainers = [\".navbar-nav\", \".nav\", \".navigation\", \".page-header-headings\", \".page-context-header\"]\n\n        for (var i = 0; i < navContainers.length; i++) {\n          var container = document.querySelector(navContainers[i])\n          if (container) {\n            targetContainer = container\n            insertMethod = \"append\"\n            break\n          }\n        }\n      }\n\n      if (targetContainer) {\n        switch (insertMethod) {\n          case \"after\":\n            if (referenceElement && referenceElement.nextSibling) {\n              targetContainer.insertBefore(buttonContainer, referenceElement.nextSibling)\n            } else {\n              targetContainer.appendChild(buttonContainer)\n            }\n            break\n          case \"before\":\n            targetContainer.insertBefore(buttonContainer, referenceElement)\n            break\n          case \"prepend\":\n            targetContainer.insertBefore(buttonContainer, targetContainer.firstChild)\n            break\n          case \"append\":\n          default:\n            targetContainer.appendChild(buttonContainer)\n            break\n        }\n      }\n    },\n  }\n\n  return QuestionBankButton\n})\n"],"names":["define","window","M","$","Str","init","cmid","this","addQuestionBankButton","tryAddButton","document","ready","setTimeout","querySelector","questionBankUrl","cfg","wwwroot","get_string","then","buttonText","createButton","catch","url","questionBankButton","createElement","href","className","innerHTML","buttonContainer","appendChild","actionMenu","submissionLinks","existingReportButton","targetContainer","insertMethod","referenceElement","parentNode","navContainers","i","length","container","nextSibling","insertBefore","firstChild"],"mappings":"AAEA,IAAIA,OAASC,OAAOD,OAChBE,EAAID,OAAOC,EAEfF,OAAM,wCAAC,CAAC,SAAU,YAAa,CAACG,EAAGC,OACR,CACvBC,KAAM,SAAUC,MACdC,KAAKD,KAAOA,MAAQ,EAEhBC,KAAKD,KAAO,GACdC,KAAKC,uBAER,EAEDA,sBAAuB,WAIrBD,KAAKE,eAGLN,EAAEO,UAAUC,MAAM,KAChBJ,KAAKE,iBAIPG,WAAW,KACTL,KAAKE,gBACJ,KAGHG,WAAW,KACTL,KAAKE,gBACJ,IACJ,EAEDA,aAAc,WAEZ,IAAIC,SAASG,cAAc,4BAA3B,CAIA,IAAIC,gBAAkBZ,EAAEa,IAAIC,QAAU,4CAA8CT,KAAKD,KAEzFF,IAAIa,WAAW,gBAAiB,oBAC7BC,KAAMC,aACLZ,KAAKa,aAAaN,gBAAiBK,cAEpCE,MAAM,KAELd,KAAKa,aAAaN,gBAAiB,kBAVvC,CAYD,EAEDM,aAAcA,CAACE,IAAKH,cAClB,IAAIT,SAASG,cAAc,4BAA3B,CAIA,IAAIU,mBAAqBb,SAASc,cAAc,KAChDD,mBAAmBE,KAAOH,IAC1BC,mBAAmBG,UAAY,oBAC/BH,mBAAmBI,UAAY,yCAA2CR,WAE1E,IAAIS,gBAAkBlB,SAASc,cAAc,OAC7CI,gBAAgBF,UAAY,kCAC5BE,gBAAgBC,YAAYN,oBAE5B,IAAIO,WAAapB,SAASG,cAAc,wBACpCkB,gBAAkBrB,SAASG,cAAc,YACzCmB,qBAAuBtB,SAASG,cAAc,0BAE9CoB,gBAAkB,KAClBC,aAAe,SACfC,iBAAmB,KAEvB,GAAIH,uBAAyBD,iBAAmBD,YAE9CG,gBAAkBD,qBAAqBI,WACvCF,aAAe,QACfC,iBAAmBH,0BACd,GAAIF,WAETG,gBAAkBH,WAClBI,aAAe,cACV,GAAIH,gBAETE,gBAAkBF,gBAAgBK,YAAcL,gBAChDG,aAAe,cAKf,IAFA,IAAIG,cAAgB,CAAC,cAAe,OAAQ,cAAe,wBAAyB,wBAE3EC,EAAI,EAAGA,EAAID,cAAcE,OAAQD,IAAK,CAC7C,IAAIE,UAAY9B,SAASG,cAAcwB,cAAcC,IACrD,GAAIE,UAAW,CACbP,gBAAkBO,UAClBN,aAAe,SACf,KACF,CACF,CAGF,GAAID,gBACF,OAAQC,cACN,IAAK,QACCC,kBAAoBA,iBAAiBM,YACvCR,gBAAgBS,aAAad,gBAAiBO,iBAAiBM,aAE/DR,gBAAgBJ,YAAYD,iBAE9B,MACF,IAAK,SACHK,gBAAgBS,aAAad,gBAAiBO,kBAC9C,MACF,IAAK,UACHF,gBAAgBS,aAAad,gBAAiBK,gBAAgBU,YAC9D,MAEF,QACEV,gBAAgBJ,YAAYD,iBA/DlC"}
